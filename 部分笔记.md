# 软件与系统安全总结与大作业

## 讲了什么

### 1.关于题的部分。
* 所有的程序在运行的时候都存在一个存储的问题。**往一个固定的空间里放超过容量的东西**，只能重新分配存储空间。
    * **将`section`变长**，但是**操作有难度**。每一条指令的寻址都是相对地址寻址。插入`section`会影响距离，可能会涉及到所有的都往后移动了，所以得找出所有的变化后的相对地址。思路可以，可行性难。
    * **在文件尾部添加，只需要改一个指针。** 整个文件放进去，不会对附加的数据进行特殊处理。找到附加数据的地址，再计算相对位置，改指针。
* **如何修改屏幕中显示的字**
    * **`testout`函数内部调用一个自己的代码，即调用一个假函数**，然后对参数指针进行定位和修改，再`jump`回真函数。改计算器、笔记本、外挂都是这样写的。
    * **屏幕取词**：检测`testout`函数，有两个参数：字符串和位置。理论上是可以知道屏幕全部位置的显示的全部字符串。
    
* **`IAT hook`**：
  * 攻击者的限制条件很多，不能采用一些技术。例如运行一个`exe`，体积什么的不能太大，注意隐蔽性，一般2-3kb。
  * `threat inject` 线程注入技术。操作什么东西首先要得到它的句柄。`openprocess`是正在运行的。`createprocess`会返回一个句柄。
  * 通俗地讲分两步：①**派一个间谍**，②**间谍需要干什么。**

### 2、其他

* 安全厂商提供的服务都是三步。**信息获取、信息分析、信息呈现**。

* **病毒查杀**：
* **病毒的规则库，是以哈希值为代表的一些静态特征。**其实就是**特征匹配**。算一个哈希值，然后去哈希表（规则库）里匹配。
    * 哈希是唯一一个与数据量无关的函数。
  
* 哪个是病毒，哪个不是病毒？
    * **规则库更新的问题。**
  
* **漏洞挖掘**：
  * 顶尖的软件攻防问题。最核心的竞争：谁先发现安全漏洞。
  
* **神经网络**：
  * `m`个输入，通过黑盒映射，第一代是`*和+`运算，后来增加了反馈增强，得到`n`个输出。

* **`shellcode`**：
  *  缓冲区溢出攻击实验，覆盖完了`RETURN`，接管程序执行是一段机器指令，一般是汇编，这段机器指令就是`shellcode`。`shellcode`软件漏洞通常会是一个下载执行器。
* **机器学习**：
  * 其实是标记和没有标记的比较。归根到底是一种比较的判断，相对来说复杂。
  * 库已经好了，可以直接用。首先开始要训练。给一些已知的`shellcode`（样本），正反来两方面的规律，再给一个未知的，去判断。
  * 所以需要收集已知的恶意程序的样本，再分类两组：训练组和测试组。
* **计算机用户行为分析**：
  * 聚类结果
  * 隐私问题：去掉敏感信息或者从来源方面（匿名）

* **`cuckoo`**：
  * 恶意软件行为分析。用来进行软件行为分析的沙箱系统。
    * `automated malware analysis`
    * 可以`trace api calls and general behavior of the file.`
  * 安装好就是一个虚拟机。
  * 可以直接去找恶意软件放进去跑。看日志。
* **键盘记录器**：
  * 恶意软件，系统分析
  * 代码：键盘鼠标行为，都能被完整的记录下来，形成一个记录文件。
  
* **截屏**：
  * 对于键盘记录器来讲，软键盘调用。需要进行截屏操作，甚至会涉及到录屏。

* **监控粘贴板** ：
  * 粘贴板是最不安全的，是个全局共享的，任何进程都能读写监控。
  
* **整个的程序进程创建**：
  * 可以监控到程序进程的创建，可以获得`processid`和`processname`，`PID`等。
  * 可以对抗防御型软件，比如停掉或者启动一个假进程。或者防御进程启动后，如果没有能力对抗，可以自行退出，删除自己的文件，进行躲避。

### 3、再其他

* **几类工作**：
  * 互联网应用（后台数据，前段显示）
  
  * `http web`系统
  
  * 数据存储数据分析，大数据与人工智能。
  
  * 专门去做视觉类开发的，游戏、视频渲染相关的。
  
* **分两条路**：
  * 去做**应用开发**。
    * 开发语言和框架。
      * 学习两道三门开发语言：`java`、`python`、`php`等。
      * 框架是一系列接口和回调和事件处理。
      * 具体框架都有教程。
    * 虚拟环境，云计算，`docker`等。
    * 高性能并发大型系统构建。
  * 去做**信息安全**。
  
* 安全 -- ① 逆向 -- ② 漏洞原理 -- ③ 自动化测试（模糊测试为代表） -- ④ 程序分析（符号执行） 
  * 基础与材料：
    * 自动化测试：安全性测试角度：最可用的是**模糊测试（fuzzing）** 构造随机数去输入，做测试。大部分漏洞程序对输入合法性很少或没有校验。
      * **栈溢出**：数据长度超过了预先分配内存的长度。是一种程序期望的数据与真实接收到的数据的长度不一致。
      * **堆溢出**：类似栈溢出，发生的位置不一样。
      * **`sql`注入**：因为`sql`数据库请求参数的，忘记了`sql`语句是可以嵌套的。功能远远多于的。
      * **`xss`**：用户输入的数据，本身预想的是文字，实际上输入了代码。
      *  任何漏洞都是：期望输入与匹配的问题。
      * 模糊测试的系统：`Honggfuzz`、`AFL`、`FUZZER`、`SES`、`VUzzer`。
    * 程序分析：
      * **符号执行**：使用符号值代替真实值执行。程序的执行流程的树，并去找每一条分支的执行条件，再使用约束求解器来求出借或证明不能用。
      * `Z3`：约束求解器里最好的。在线版本，还有`python`接口。
        * 可以从理论中，找出程序中任何一个角落的代码执行过程。现实中有难度，计算复杂度有难度。
