## 实验要求

* 5、通过API hook的方法，在每次notepad保存txt文件时，就将文件内容修改为： “you have been hacked!”

* 提示：API hook 的关键是编写一个假函数，用假函数的指针替换IAT中真函数的指针（当然这种方式只能对通过IAT调用的管用，但是够了。）在假函数调用真函数，修改真函数的参数和返回的数据，将修改后的数据返回给调用者。

## 实验基本过程概述
* 实验思路
    * 本实验的基本思想就是使用API hook 构建一个假的函数，注意假函数里调用了真函数，修改真函数的参数与返回数据，然后将修改过的数据返回给调用者。
    * 同时通过IAT，在程序调用真函数的时候，检测到该行为，直接调用假函数。由于假函数里同时调用了真函数，返回的结果与真函数也基本一致，故调用者不会发现。这样就完成实验。
* 实验步骤
实验基本分为两个部分：
    * 第一步，先创建一个“间谍”假函数。
    * 第二步，将该“间谍”派遣到需要它的地方。
* 实验报告阐述
    * 第五题第一部分为第二步，也即载入假函数过程。
    * 第五题第二部分为第一步，也即创建一个假函数过程。
    * 前两部分都是基于一个很简单的目标，例如调用一下`calc.exe`或`MessageBoxA`等。第五题第三部分为真正的第五题实现。

## 参考资料

[TheMasterOfMagic/SecurityOfSoftwareAndSystem/5](https://github.com/TheMasterOfMagic/SecurityOfSoftwareAndSystem/tree/master/5)

[tinysec/iathook](https://github.com/tinysec/iathook)



